---
epic: flutterflow-to-clean-architecture-migration
status: backlog
priority: P1
estimate: 5-6 hours
depends_on: [023]
week: 5
---

# Task 024: Migrate Detail Page UI with Charts

## Description

Migrate Item Detail Page UI from FlutterFlow including event log display, bar charts, cumulative charts, and date range selector. Integrate with EventsBloc and ChartsBloc.

## Acceptance Criteria

- [ ] ItemDetailPage created
- [ ] BarChartWidget created using fl_chart
- [ ] CumulativeChartWidget created
- [ ] DateRangeSelector widget created
- [ ] EventLogListWidget created
- [ ] All widgets integrated with BLoCs
- [ ] Charts update when date range changes
- [ ] Real-time event updates displayed

## Technical Details

**ItemDetailPage**:
```dart
class ItemDetailPage extends StatelessWidget {
  final String itemId;

  const ItemDetailPage({required this.itemId});

  @override
  Widget build(BuildContext context) {
    return MultiBlocProvider(
      providers: [
        BlocProvider(
          create: (_) => sl<EventsBloc>()
            ..add(LoadEvents(itemId: itemId)),
        ),
        BlocProvider(
          create: (_) => sl<ChartsBloc>()
            ..add(LoadBarChart(
              startDate: DateTime.now().subtract(const Duration(days: 30)),
              endDate: DateTime.now(),
              aggregationLevel: 'daily',
            )),
        ),
      ],
      child: Scaffold(
        appBar: AppBar(title: const Text('Item Details')),
        body: SingleChildScrollView(
          child: Column(
            children: [
              DateRangeSelector(),
              BarChartWidget(),
              CumulativeChartWidget(),
              EventLogListWidget(),
            ],
          ),
        ),
      ),
    );
  }
}
```

**BarChartWidget** (using fl_chart):
```dart
class BarChartWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return BlocBuilder<ChartsBloc, ChartsState>(
      builder: (context, state) {
        if (state is ChartsLoading) {
          return const CircularProgressIndicator();
        }
        if (state is ChartsLoaded) {
          return Container(
            height: 300,
            padding: const EdgeInsets.all(16),
            child: BarChart(
              BarChartData(
                barGroups: state.chartData.dataPoints.asMap().entries.map((entry) {
                  return BarChartGroupData(
                    x: entry.key,
                    barRods: [
                      BarChartRodData(
                        toY: entry.value.value.toDouble(),
                        color: Colors.blue,
                      ),
                    ],
                  );
                }).toList(),
                titlesData: FlTitlesData(
                  bottomTitles: AxisTitles(
                    sideTitles: SideTitles(
                      showTitles: true,
                      getTitlesWidget: (value, meta) {
                        if (value.toInt() < state.chartData.dataPoints.length) {
                          final date = state.chartData.dataPoints[value.toInt()].date;
                          return Text('${date.month}/${date.day}');
                        }
                        return const Text('');
                      },
                    ),
                  ),
                ),
              ),
            ),
          );
        }
        return const SizedBox.shrink();
      },
    );
  }
}
```

## Dependencies

- Task 023: ChartsBloc
- Task 022: EventsBloc
- fl_chart package

## Testing

Widget tests:
- Test detail page renders correctly
- Test charts display data
- Test date range selector changes charts
- Test event list updates with real-time events

## Notes

- Use fl_chart for professional-looking charts
- Charts should be interactive (tap to see values)
- Date range selector defaults to last 30 days
- Event log shows most recent events first
