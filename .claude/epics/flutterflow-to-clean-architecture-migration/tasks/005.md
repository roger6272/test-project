---
epic: flutterflow-to-clean-architecture-migration
status: backlog
priority: P0
estimate: 4-5 hours
depends_on: [001, 004]
week: 1
---

# Task 005: Set Up Testing Infrastructure

## Description

Establish comprehensive testing infrastructure including test folder structure, test utilities, mock setup, and CI/CD configuration for automated testing. This foundation enables Test-Driven Development (TDD) for all future features.

## Acceptance Criteria

- [ ] Test folder structure created:
  - [ ] `test/core/` (for core utilities tests)
  - [ ] `test/features/{feature}/` (mirror lib structure)
  - [ ] `test/fixtures/` (test data)
  - [ ] `test/helpers/` (test utilities)
- [ ] Test utilities created:
  - [ ] Mock data factories
  - [ ] Test helpers for BLoC testing
  - [ ] Fixture reader utility
- [ ] GitHub Actions workflow configured for CI/CD
- [ ] Code coverage reporting enabled
- [ ] Sample tests created and passing

## Technical Details

**Test folder structure**:
```
test/
├── core/
│   ├── error/
│   ├── usecases/
│   └── utils/
├── features/
│   ├── items/
│   │   ├── data/
│   │   ├── domain/
│   │   └── presentation/
│   ├── bluetooth/
│   ├── events/
│   ├── auth/
│   ├── export/
│   └── profile/
├── fixtures/
│   ├── item.json
│   ├── event.json
│   └── user.json
└── helpers/
    ├── test_helper.dart
    └── fixture_reader.dart
```

**test/helpers/fixture_reader.dart**:
```dart
import 'dart:io';

String fixture(String name) => File('test/fixtures/$name').readAsStringSync();
```

**test/helpers/test_helper.dart**:
```dart
import 'package:mocktail/mocktail.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';

// Mock classes
class MockFirebaseFirestore extends Mock implements FirebaseFirestore {}
class MockFirebaseAuth extends Mock implements FirebaseAuth {}

// Add more mocks as features are developed
```

**Sample test (test/core/utils/validators_test.dart)**:
```dart
import 'package:flutter_test/flutter_test.dart';
import 'package:trackwise/core/utils/validators.dart';

void main() {
  group('Validators', () {
    group('validateItemName', () {
      test('should return null for valid name', () {
        final result = Validators.validateItemName('Coffee');
        expect(result, null);
      });

      test('should return error for empty name', () {
        final result = Validators.validateItemName('');
        expect(result, 'Item name is required');
      });

      test('should return error for name > 30 chars', () {
        final result = Validators.validateItemName('A' * 31);
        expect(result, 'Item name must be 30 characters or less');
      });
    });
  });
}
```

**.github/workflows/test.yml**:
```yaml
name: Tests

on:
  push:
    branches: [ main, feature/* ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.22.0'
          channel: 'stable'

      - name: Install dependencies
        run: flutter pub get

      - name: Analyze code
        run: flutter analyze

      - name: Run tests
        run: flutter test --coverage

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
```

**Test fixtures (test/fixtures/item.json)**:
```json
{
  "id": "test_item_123",
  "item_name": "Test Item",
  "count": 10,
  "todaycount": 5,
  "increment_by": 1,
  "reminder": "TARGET",
  "reminder_value": 20,
  "lastResetTime": 1704067200000,
  "lastUpdated": 1704153600000
}
```

## Dependencies

- Task 001: Folder structure must exist
- Task 004: Testing packages must be installed

## Testing

- [ ] Run `flutter test` - all sample tests should pass
- [ ] Verify coverage report generated: `coverage/lcov.info` exists
- [ ] Check GitHub Actions workflow in repository (after push)
- [ ] Verify fixture reader works: `fixture('item.json')` returns content

## Notes

- This is foundational - invest time to get it right
- Use mocktail (not mockito) for null-safe mocking
- Coverage goal: 70%+ for business logic, 50%+ for UI
- Integration tests will be added later (Week 4-5)
- CI/CD workflow runs on every push to feature branches
