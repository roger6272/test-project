---
epic: flutterflow-to-clean-architecture-migration
status: backlog
priority: P0
estimate: 4-5 hours
depends_on: [003, 005]
week: 2
---

# Task 007: Implement Items Domain Layer

## Description

Create the domain layer for Items feature including the Item entity, repository interface, and all use cases. This pure Dart layer contains the core business logic for item management.

## Acceptance Criteria

- [ ] Item entity created in `features/items/domain/entities/item.dart`
- [ ] ItemRepository interface created in `features/items/domain/repositories/item_repository.dart`
- [ ] 5 use cases created in `features/items/domain/usecases/`:
  - [ ] `get_items.dart` - Fetch all items for user
  - [ ] `create_item.dart` - Create new item with validation
  - [ ] `update_item.dart` - Update existing item
  - [ ] `delete_item.dart` - Delete item
  - [ ] `activate_item.dart` - Toggle item activation state
- [ ] All use cases extend base UseCase class
- [ ] All use cases return Either<Failure, T>
- [ ] Item entity uses Equatable for value equality

## Technical Details

**Item Entity** (domain/entities/item.dart):
```dart
import 'package:equatable/equatable.dart';

enum ReminderType { none, target, interval, everyTime }

class Item extends Equatable {
  final String id;
  final String name;
  final int count;
  final int todayCount;
  final int incrementBy;
  final ReminderType reminder;
  final int reminderValue;
  final DateTime lastResetTime;
  final DateTime lastUpdated;
  final String userId;

  const Item({
    required this.id,
    required this.name,
    required this.count,
    required this.todayCount,
    required this.incrementBy,
    required this.reminder,
    required this.reminderValue,
    required this.lastResetTime,
    required this.lastUpdated,
    required this.userId,
  });

  @override
  List<Object?> get props => [id, name, count, todayCount, incrementBy,
    reminder, reminderValue, lastResetTime, lastUpdated, userId];
}
```

**Repository Interface** (domain/repositories/item_repository.dart):
```dart
import 'package:dartz/dartz.dart';
import '../../../../core/error/failures.dart';
import '../entities/item.dart';

abstract class ItemRepository {
  Future<Either<Failure, List<Item>>> getItems();
  Future<Either<Failure, void>> createItem(Item item);
  Future<Either<Failure, void>> updateItem(Item item);
  Future<Either<Failure, void>> deleteItem(String id);
  Future<Either<Failure, void>> activateItem(String id);
  Stream<List<Item>> watchItems();
}
```

**Sample Use Case** (domain/usecases/get_items.dart):
```dart
import 'package:dartz/dartz.dart';
import '../../../../core/error/failures.dart';
import '../../../../core/usecases/usecase.dart';
import '../entities/item.dart';
import '../repositories/item_repository.dart';

class GetItemsUseCase implements UseCase<List<Item>, NoParams> {
  final ItemRepository repository;

  GetItemsUseCase(this.repository);

  @override
  Future<Either<Failure, List<Item>>> call(NoParams params) async {
    return await repository.getItems();
  }
}
```

**Create Item Use Case** (with validation):
```dart
class CreateItemUseCase implements UseCase<void, CreateItemParams> {
  final ItemRepository repository;

  CreateItemUseCase(this.repository);

  @override
  Future<Either<Failure, void>> call(CreateItemParams params) async {
    // Validation
    if (params.item.name.isEmpty) {
      return Left(ValidationFailure('Item name cannot be empty'));
    }
    if (params.item.name.length > 30) {
      return Left(ValidationFailure('Item name must be 30 characters or less'));
    }
    if (params.item.incrementBy < 1 || params.item.incrementBy > 100) {
      return Left(ValidationFailure('Increment must be between 1 and 100'));
    }

    return await repository.createItem(params.item);
  }
}

class CreateItemParams {
  final Item item;
  CreateItemParams({required this.item});
}
```

## Dependencies

- Task 003: Base classes created (UseCase, Failure)
- Task 005: Testing infrastructure (for unit tests)

## Testing

Write unit tests in `test/features/items/domain/usecases/`:

```dart
// test/features/items/domain/usecases/get_items_test.dart
void main() {
  late GetItemsUseCase useCase;
  late MockItemRepository mockRepository;

  setUp(() {
    mockRepository = MockItemRepository();
    useCase = GetItemsUseCase(mockRepository);
  });

  test('should return items from repository', () async {
    // arrange
    final testItems = [testItem];
    when(() => mockRepository.getItems())
        .thenAnswer((_) async => Right(testItems));

    // act
    final result = await useCase(NoParams());

    // assert
    expect(result, Right(testItems));
    verify(() => mockRepository.getItems()).called(1);
  });
}
```

- [ ] Unit tests for all 5 use cases
- [ ] Test success paths
- [ ] Test failure paths (validation, repository errors)
- [ ] Verify repository methods are called correctly

## Notes

- Domain layer has NO dependencies on Flutter or external packages (except dartz)
- Keep entities immutable (final fields)
- Use descriptive use case names (verb + noun)
- Params classes clarify use case inputs
