---
epic: flutterflow-to-clean-architecture-migration
status: backlog
priority: P0
estimate: 3-4 hours
depends_on: [001]
week: 1
---

# Task 002: Configure GetIt Dependency Injection

## Description

Set up GetIt service locator for dependency injection throughout the app. This enables loose coupling, testability, and clean dependency management across all layers.

## Acceptance Criteria

- [ ] GetIt package configured in `pubspec.yaml` (already exists, verify version)
- [ ] Injectable package added for code generation
- [ ] `core/di/injection.dart` file created with GetIt setup
- [ ] Service locator initialized in `main.dart`
- [ ] Registration functions created for:
  - [ ] External dependencies (Firebase, Bluetooth)
  - [ ] Data sources (placeholder structure)
  - [ ] Repositories (placeholder structure)
  - [ ] Use cases (placeholder structure)
  - [ ] BLoCs (placeholder structure)
- [ ] Injectable code generation configured with build_runner
- [ ] GetIt initialization tested (app launches without errors)

## Technical Details

**Dependencies to add**:
```yaml
dependencies:
  get_it: ^7.6.0  # Already exists
  injectable: ^2.3.0  # NEW

dev_dependencies:
  injectable_generator: ^2.4.0  # NEW
  build_runner: ^2.4.0  # May need to add
```

**injection.dart structure**:
```dart
import 'package:get_it/get_it.dart';
import 'package:injectable/injectable.dart';
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';

import 'injection.config.dart';

final sl = GetIt.instance;

@InjectableInit()
Future<void> configureDependencies() async => sl.init();

Future<void> init() async {
  // External dependencies
  sl.registerLazySingleton(() => FirebaseFirestore.instance);
  sl.registerLazySingleton(() => FirebaseAuth.instance);

  // TODO: Will be populated as features are developed
  // Data sources will be registered here
  // Repositories will be registered here
  // Use cases will be registered here
  // BLoCs will be registered as factories here
}
```

**main.dart initialization**:
```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  // Initialize Firebase (existing code)
  await initFirebase();

  // Initialize dependency injection (NEW)
  await configureDependencies();

  runApp(MyApp());
}
```

**Build runner command**:
```bash
flutter pub run build_runner build --delete-conflicting-outputs
```

## Dependencies

- Task 001: Folder structure must exist

## Testing

- [ ] Run `flutter pub run build_runner build`
- [ ] Verify `injection.config.dart` is generated
- [ ] Launch app and verify no GetIt errors
- [ ] Test that Firebase instances can be retrieved: `sl<FirebaseFirestore>()`

## Notes

- Injectable will auto-generate registration code as we add @injectable annotations
- For now, manual registration is acceptable
- BLoCs should use factory registration (new instance per use)
- Repositories and data sources should use singleton registration
