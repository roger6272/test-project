---
epic: flutterflow-to-clean-architecture-migration
status: backlog
priority: P0
estimate: 6-7 hours
depends_on: [017]
week: 4
---

# Task 018: Migrate Bluetooth UI (Scan, Connect, Manage)

## Description

Migrate Bluetooth UI pages from FlutterFlow including device scanning page, device management page, and connection status widgets. Integrate with BluetoothBloc for state management.

## Acceptance Criteria

- [ ] BluetoothSearchPage created for scanning
- [ ] DeviceManagementPage created for managing connections
- [ ] DeviceListTile widget for displaying devices
- [ ] ConnectionStatusWidget for showing connection state
- [ ] Permission handling implemented (Android/iOS)
- [ ] UI matches FlutterFlow design
- [ ] All pages use BlocProvider and BlocBuilder

## Technical Details

**BluetoothSearchPage**:
```dart
class BluetoothSearchPage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return BlocProvider(
      create: (_) => sl<BluetoothBloc>()..add(StartScan()),
      child: Scaffold(
        appBar: AppBar(title: const Text('Search Devices')),
        body: BlocConsumer<BluetoothBloc, BluetoothState>(
          listener: (context, state) {
            if (state is BluetoothConnected) {
              context.pop();
            }
            if (state is BluetoothError) {
              ScaffoldMessenger.of(context).showSnackBar(
                SnackBar(content: Text(state.message)),
              );
            }
          },
          builder: (context, state) {
            if (state is BluetoothScanning || state is BluetoothInitial) {
              return const Center(child: CircularProgressIndicator());
            }
            if (state is BluetoothDevicesFound) {
              return ListView.builder(
                itemCount: state.devices.length,
                itemBuilder: (context, index) {
                  return DeviceListTile(
                    device: state.devices[index],
                    onTap: () {
                      context.read<BluetoothBloc>().add(
                        ConnectDevice(state.devices[index].id),
                      );
                    },
                  );
                },
              );
            }
            return const SizedBox.shrink();
          },
        ),
      ),
    );
  }
}
```

**DeviceListTile**:
```dart
class DeviceListTile extends StatelessWidget {
  final BluetoothDevice device;
  final VoidCallback onTap;

  const DeviceListTile({required this.device, required this.onTap});

  @override
  Widget build(BuildContext context) {
    return ListTile(
      leading: const Icon(Icons.bluetooth),
      title: Text(device.name),
      subtitle: Text('Signal: ${device.rssi} dBm'),
      trailing: const Icon(Icons.arrow_forward_ios),
      onTap: onTap,
    );
  }
}
```

## Dependencies

- Task 017: BluetoothBloc
- Permission handler package for BLE permissions

## Testing

Widget tests for:
- Scanning page displays devices
- Connection flow works
- Permission requests handled
- Error states shown

## Notes

- Request Bluetooth permissions before scanning
- Show loading during connection
- Handle denied permissions gracefully
