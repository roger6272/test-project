---
epic: flutterflow-to-clean-architecture-migration
status: backlog
priority: P0
estimate: 3-4 hours
depends_on: [001]
week: 1
---

# Task 003: Create Base Classes and Core Utilities

## Description

Implement fundamental base classes and utilities that will be used across all features. This includes UseCase base class, Failure types, Exception types, and common utilities.

## Acceptance Criteria

- [ ] `core/usecases/usecase.dart` created with base UseCase interface
- [ ] `core/error/failures.dart` created with Failure classes:
  - [ ] ServerFailure
  - [ ] CacheFailure
  - [ ] BluetoothFailure
  - [ ] AuthFailure
  - [ ] ValidationFailure
- [ ] `core/error/exceptions.dart` created with Exception classes:
  - [ ] ServerException
  - [ ] CacheException
  - [ ] BluetoothException
  - [ ] AuthException
- [ ] `core/utils/constants.dart` created with app constants
- [ ] `core/utils/bluetooth_constants.dart` created with BLE UUIDs and constants
- [ ] `core/utils/validators.dart` created with validation utilities
- [ ] All classes properly use Equatable for value equality

## Technical Details

**usecase.dart**:
```dart
import 'package:dartz/dartz.dart';
import '../error/failures.dart';

abstract class UseCase<Type, Params> {
  Future<Either<Failure, Type>> call(Params params);
}

class NoParams {}
```

**failures.dart**:
```dart
import 'package:equatable/equatable.dart';

abstract class Failure extends Equatable {
  final String message;

  const Failure(this.message);

  @override
  List<Object> get props => [message];
}

class ServerFailure extends Failure {
  const ServerFailure(String message) : super(message);
}

class CacheFailure extends Failure {
  const CacheFailure(String message) : super(message);
}

class BluetoothFailure extends Failure {
  const BluetoothFailure(String message) : super(message);
}

class AuthFailure extends Failure {
  const AuthFailure(String message) : super(message);
}

class ValidationFailure extends Failure {
  const ValidationFailure(String message) : super(message);
}
```

**exceptions.dart**:
```dart
class ServerException implements Exception {
  final String message;
  ServerException(this.message);
}

class CacheException implements Exception {
  final String message;
  CacheException(this.message);
}

class BluetoothException implements Exception {
  final String message;
  BluetoothException(this.message);
}

class AuthException implements Exception {
  final String message;
  AuthException(this.message);
}
```

**bluetooth_constants.dart**:
```dart
class BluetoothConstants {
  // ESP32 BLE Service and Characteristics
  static const String serviceUUID = '12345678-1234-1234-1234-123456789000';
  static const String readCharacteristicUUID = '12345678-1234-1234-1234-123456789001';
  static const String notifyCharacteristicUUID = '12345678-1234-1234-1234-123456789002';
  static const String setItemsCharacteristicUUID = '12345678-1234-1234-1234-123456789008';
  static const String writeCharacteristicUUID = '12345678-1234-1234-1234-123456789010';

  // Chunking
  static const int mtuLimit = 180;
  static const int chunkDelayMs = 30;

  // Timeouts
  static const int scanTimeoutSeconds = 15;
  static const int connectionTimeoutSeconds = 5;
}
```

**validators.dart**:
```dart
class Validators {
  static String? validateItemName(String? value) {
    if (value == null || value.isEmpty) {
      return 'Item name is required';
    }
    if (value.length > 30) {
      return 'Item name must be 30 characters or less';
    }
    return null;
  }

  static String? validateEmail(String? value) {
    if (value == null || value.isEmpty) {
      return 'Email is required';
    }
    final emailRegex = RegExp(r'^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$');
    if (!emailRegex.hasMatch(value)) {
      return 'Invalid email format';
    }
    return null;
  }

  static String? validateIncrementValue(int? value) {
    if (value == null) {
      return 'Increment value is required';
    }
    if (value < 1 || value > 100) {
      return 'Increment must be between 1 and 100';
    }
    return null;
  }

  static String? validateReminderValue(int? value) {
    if (value == null) {
      return 'Reminder value is required';
    }
    if (value < 0 || value > 1000) {
      return 'Reminder value must be between 0 and 1000';
    }
    return null;
  }
}
```

## Dependencies

- Task 001: Folder structure must exist
- Dartz package must be added (Task 004)

## Testing

- [ ] Import all base classes in a test file to verify no compilation errors
- [ ] Verify Equatable works correctly for Failures
- [ ] Test validators with various inputs
- [ ] Verify constants are accessible

## Notes

- These classes form the foundation for all features
- Use const constructors where possible for performance
- Validators can be expanded as needed during feature development
